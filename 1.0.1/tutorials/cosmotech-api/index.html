
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive guide to working with the CosmoTech API in CoAL: authentication, workspaces, Twin Data Layer, and more">
      
      
      
        <link rel="canonical" href="https://cosmo-tech.github.io/CosmoTech-Acceleration-Library/1.0.1/tutorials/cosmotech-api/">
      
      
        <link rel="prev" href="../contributing/">
      
      
        <link rel="next" href="../csm-data/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Working with the CosmoTech API - Cosmotech Acceleration Library Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/templates.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Working with the CosmoTech API - Cosmotech Acceleration Library Docs" >
      
        <meta  property="og:description"  content="Comprehensive guide to working with the CosmoTech API in CoAL: authentication, workspaces, Twin Data Layer, and more" >
      
        <meta  property="og:image"  content="https://cosmo-tech.github.io/CosmoTech-Acceleration-Library/1.0.1/assets/images/social/tutorials/cosmotech-api.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://cosmo-tech.github.io/CosmoTech-Acceleration-Library/1.0.1/tutorials/cosmotech-api/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Working with the CosmoTech API - Cosmotech Acceleration Library Docs" >
      
        <meta  name="twitter:description"  content="Comprehensive guide to working with the CosmoTech API in CoAL: authentication, workspaces, Twin Data Layer, and more" >
      
        <meta  name="twitter:image"  content="https://cosmo-tech.github.io/CosmoTech-Acceleration-Library/1.0.1/assets/images/social/tutorials/cosmotech-api.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#working-with-the-cosmotech-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cosmotech Acceleration Library Docs" class="md-header__button md-logo" aria-label="Cosmotech Acceleration Library Docs" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cosmotech Acceleration Library Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Working with the CosmoTech API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Cosmo-Tech/CosmoTech-Acceleration-Library" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Cosmo-Tech/CosmoTech-Acceleration-Library
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../dependencies/" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../csm-data/" class="md-tabs__link">
          
  
  
    
  
  csm-data

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cosmotech Acceleration Library Docs" class="md-nav__button md-logo" aria-label="Cosmotech Acceleration Library Docs" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Cosmotech Acceleration Library Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Cosmo-Tech/CosmoTech-Acceleration-Library" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Cosmo-Tech/CosmoTech-Acceleration-Library
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pull_request/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pull Request Checklist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing to CoAL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Working with the CosmoTech API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Working with the CosmoTech API
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="In this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      In this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-the-cosmotech-api-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to the CosmoTech API Integration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-entra-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Azure Entra Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-workspaces" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Workspaces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with Workspaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-files" class="md-nav__link">
    <span class="md-ellipsis">
      Listing Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-files" class="md-nav__link">
    <span class="md-ellipsis">
      Downloading Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-files" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twin-data-layer-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Twin Data Layer Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Twin Data Layer Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv-file-format" class="md-nav__link">
    <span class="md-ellipsis">
      CSV File Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parsing-csv-files" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing CSV Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-cypher-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Generating Cypher Queries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runner-and-run-management" class="md-nav__link">
    <span class="md-ellipsis">
      Runner and Run Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runner and Run Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-runner-data" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Runner Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-runner-data" class="md-nav__link">
    <span class="md-ellipsis">
      Downloading Runner Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-workflow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Workflow Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices and Tips
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices and Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../csm-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSM-DATA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datastore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datastore
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../csm-data/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    csm-data
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            csm-data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/adx-send-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    adx-send-data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/adx-send-runnerdata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    adx-send-runnerdata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/az-storage-upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    az-storage-upload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/s3-bucket-delete/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    s3-bucket-delete
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/s3-bucket-download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    s3-bucket-download
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/s3-bucket-upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    s3-bucket-upload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Api
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Api
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../csm-data/api/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8_1" id="__nav_4_8_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8_1">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/postgres-send-runner-metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    postgres-send-runner-metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/rds-load-csv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rds-load-csv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/rds-send-csv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rds-send-csv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/rds-send-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rds-send-store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/run-load-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    run-load-data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/runtemplate-load-handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    runtemplate-load-handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/tdl-load-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tdl-load-files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/tdl-send-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tdl-send-files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/wsf-load-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    wsf-load-file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/api/wsf-send-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    wsf-send-file
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Store
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Store
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../csm-data/store/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Store
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9_1" id="__nav_4_9_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9_1">
            <span class="md-nav__icon md-icon"></span>
            Store
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/dump-to-azure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dump-to-azure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/dump-to-postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dump-to-postgresql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/dump-to-s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dump-to-s3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/list-tables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    list-tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/load-csv-folder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    load-csv-folder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/load-from-singlestore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    load-from-singlestore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/rds-send-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rds-send-store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csm-data/store/reset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    reset
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="In this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      In this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-the-cosmotech-api-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to the CosmoTech API Integration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-key-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-entra-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Azure Entra Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keycloak-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Keycloak Authentication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-workspaces" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Workspaces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with Workspaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listing-files" class="md-nav__link">
    <span class="md-ellipsis">
      Listing Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-files" class="md-nav__link">
    <span class="md-ellipsis">
      Downloading Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-files" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twin-data-layer-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Twin Data Layer Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Twin Data Layer Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv-file-format" class="md-nav__link">
    <span class="md-ellipsis">
      CSV File Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parsing-csv-files" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing CSV Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-cypher-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Generating Cypher Queries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runner-and-run-management" class="md-nav__link">
    <span class="md-ellipsis">
      Runner and Run Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runner and Run Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-runner-data" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Runner Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downloading-runner-data" class="md-nav__link">
    <span class="md-ellipsis">
      Downloading Runner Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-workflow-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Workflow Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices and Tips
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices and Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="working-with-the-cosmotech-api">Working with the CosmoTech API<a class="headerlink" href="#working-with-the-cosmotech-api" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Objective</p>
<ul>
<li>Understand how to authenticate and connect to the CosmoTech API</li>
<li>Learn to work with workspaces for file management</li>
<li>Master the Twin Data Layer for graph data operations</li>
<li>Implement runner and run data management</li>
<li>Build complete workflows integrating multiple API features</li>
</ul>
</div>
<h2 id="introduction-to-the-cosmotech-api-integration">Introduction to the CosmoTech API Integration<a class="headerlink" href="#introduction-to-the-cosmotech-api-integration" title="Permanent link">&para;</a></h2>
<p>The CosmoTech Acceleration Library (CoAL) provides a comprehensive set of tools for interacting with the CosmoTech API. This integration allows you to:</p>
<ul>
<li>Authenticate with different identity providers</li>
<li>Manage workspaces and files</li>
<li>Work with the Twin Data Layer for graph data</li>
<li>Handle runners and runs</li>
<li>Process and transform data</li>
<li>Build end-to-end workflows</li>
</ul>
<p>The API integration is organized into several modules, each focused on specific functionality:</p>
<ul>
<li><strong>connection</strong>: Authentication and API client management</li>
<li><strong>workspace</strong>: Workspace file operations</li>
<li><strong>twin_data_layer</strong>: Graph data management</li>
<li><strong>runner</strong>: Runner and run data operations</li>
</ul>
<div class="admonition info">
<p class="admonition-title">API vs CLI</p>
<p>While the <code>csm-data</code> CLI provides command-line tools for many common operations, the direct API integration offers more flexibility and programmatic control. Use the API integration when you need to:</p>
<ul>
<li>Build custom workflows</li>
<li>Integrate with other Python code</li>
<li>Perform complex operations not covered by the CLI</li>
<li>Implement real-time interactions with the platform</li>
</ul>
</div>
<h2 id="authentication-and-connection">Authentication and Connection<a class="headerlink" href="#authentication-and-connection" title="Permanent link">&para;</a></h2>
<p>The first step in working with the CosmoTech API is establishing a connection. CoAL supports multiple authentication methods:</p>
<ul>
<li>API Key authentication</li>
<li>Azure Entra (formerly Azure AD) authentication</li>
<li>Keycloak authentication</li>
</ul>
<p>The <code>get_api_client()</code> function automatically detects which authentication method to use based on the environment variables you've set.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Basic connection setup</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Example: Setting up connections to the CosmoTech API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_api_client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LOGGER</span>

<span class="c1"># Method 1: Using API Key (set these environment variables before running)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.cosmotech.com&quot;</span>  <span class="c1"># Replace with your API URL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>  <span class="c1"># Replace with your actual API key</span>

<span class="c1"># Get the API client</span>
<span class="n">api_client</span><span class="p">,</span> <span class="n">connection_type</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected using: </span><span class="si">{</span><span class="n">connection_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Use the client with various API instances</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech_api.api.organization_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrganizationApi</span>

<span class="n">org_api</span> <span class="o">=</span> <span class="n">OrganizationApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

<span class="c1"># List organizations</span>
<span class="n">organizations</span> <span class="o">=</span> <span class="n">org_api</span><span class="o">.</span><span class="n">find_all_organizations</span><span class="p">()</span>
<span class="k">for</span> <span class="n">org</span> <span class="ow">in</span> <span class="n">organizations</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Organization: </span><span class="si">{</span><span class="n">org</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">org</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="c1"># Don&#39;t forget to close the client when done</span>
<span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Method 2: Using Azure Entra (set these environment variables before running)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">os.environ[&quot;CSM_API_URL&quot;] = &quot;https://api.cosmotech.com&quot;  # Replace with your API URL</span>
<span class="sd">os.environ[&quot;CSM_API_SCOPE&quot;] = &quot;api://your-app-id/.default&quot;  # Replace with your API scope</span>
<span class="sd">os.environ[&quot;AZURE_CLIENT_ID&quot;] = &quot;your-client-id&quot;  # Replace with your client ID</span>
<span class="sd">os.environ[&quot;AZURE_CLIENT_SECRET&quot;] = &quot;your-client-secret&quot;  # Replace with your client secret</span>
<span class="sd">os.environ[&quot;AZURE_TENANT_ID&quot;] = &quot;your-tenant-id&quot;  # Replace with your tenant ID</span>

<span class="sd"># Get the API client</span>
<span class="sd">api_client, connection_type = get_api_client()</span>
<span class="sd">LOGGER.info(f&quot;Connected using: {connection_type}&quot;)</span>

<span class="sd"># Use the client with various API instances</span>
<span class="sd"># ...</span>

<span class="sd"># Don&#39;t forget to close the client when done</span>
<span class="sd">api_client.close()</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Method 3: Using Keycloak (set these environment variables before running)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">os.environ[&quot;CSM_API_URL&quot;] = &quot;https://api.cosmotech.com&quot;  # Replace with your API URL</span>
<span class="sd">os.environ[&quot;IDP_BASE_URL&quot;] = &quot;https://keycloak.example.com/auth/&quot;  # Replace with your Keycloak URL</span>
<span class="sd">os.environ[&quot;IDP_TENANT_ID&quot;] = &quot;your-realm&quot;  # Replace with your realm</span>
<span class="sd">os.environ[&quot;IDP_CLIENT_ID&quot;] = &quot;your-client-id&quot;  # Replace with your client ID</span>
<span class="sd">os.environ[&quot;IDP_CLIENT_SECRET&quot;] = &quot;your-client-secret&quot;  # Replace with your client secret</span>

<span class="sd"># Get the API client</span>
<span class="sd">api_client, connection_type = get_api_client()</span>
<span class="sd">LOGGER.info(f&quot;Connected using: {connection_type}&quot;)</span>

<span class="sd"># Use the client with various API instances</span>
<span class="sd"># ...</span>

<span class="sd"># Don&#39;t forget to close the client when done</span>
<span class="sd">api_client.close()</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Environment Variables</p>
<p>You can set environment variables in your code for testing, but in production environments, it's better to set them at the system or container level for security.</p>
</div>
<h3 id="api-key-authentication">API Key Authentication<a class="headerlink" href="#api-key-authentication" title="Permanent link">&para;</a></h3>
<p>API Key authentication is the simplest method and requires two environment variables:</p>
<ul>
<li><code>CSM_API_URL</code>: The URL of the CosmoTech API</li>
<li><code>CSM_API_KEY</code>: Your API key</li>
</ul>
<h3 id="azure-entra-authentication">Azure Entra Authentication<a class="headerlink" href="#azure-entra-authentication" title="Permanent link">&para;</a></h3>
<p>Azure Entra authentication uses service principal credentials and requires these environment variables:</p>
<ul>
<li><code>CSM_API_URL</code>: The URL of the CosmoTech API</li>
<li><code>CSM_API_SCOPE</code>: The API scope (usually in the format <code>api://app-id/.default</code>)</li>
<li><code>AZURE_CLIENT_ID</code>: Your client ID</li>
<li><code>AZURE_CLIENT_SECRET</code>: Your client secret</li>
<li><code>AZURE_TENANT_ID</code>: Your tenant ID</li>
</ul>
<h3 id="keycloak-authentication">Keycloak Authentication<a class="headerlink" href="#keycloak-authentication" title="Permanent link">&para;</a></h3>
<p>Keycloak authentication requires these environment variables:</p>
<ul>
<li><code>CSM_API_URL</code>: The URL of the CosmoTech API</li>
<li><code>IDP_BASE_URL</code>: The base URL of your Keycloak server</li>
<li><code>IDP_TENANT_ID</code>: Your realm name</li>
<li><code>IDP_CLIENT_ID</code>: Your client ID</li>
<li><code>IDP_CLIENT_SECRET</code>: Your client secret</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">API Client Lifecycle</p>
<p>Always close the API client when you're done using it to release resources. The best practice is to use a <code>try</code>/<code>finally</code> block to ensure the client is closed even if an error occurs.</p>
</div>
<h2 id="working-with-workspaces">Working with Workspaces<a class="headerlink" href="#working-with-workspaces" title="Permanent link">&para;</a></h2>
<p>Workspaces in the CosmoTech platform provide a way to organize and share files. The CoAL library offers functions for listing, downloading, and uploading files in workspaces.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Workspace operations</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Example: Working with workspaces in the CosmoTech API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_api_client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">list_workspace_files</span><span class="p">,</span>
    <span class="n">download_workspace_file</span><span class="p">,</span>
    <span class="n">upload_workspace_file</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LOGGER</span>

<span class="c1"># Set up environment variables for authentication</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.cosmotech.com&quot;</span>  <span class="c1"># Replace with your API URL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>  <span class="c1"># Replace with your actual API key</span>

<span class="c1"># Organization and workspace IDs</span>
<span class="n">organization_id</span> <span class="o">=</span> <span class="s2">&quot;your-organization-id&quot;</span>  <span class="c1"># Replace with your organization ID</span>
<span class="n">workspace_id</span> <span class="o">=</span> <span class="s2">&quot;your-workspace-id&quot;</span>  <span class="c1"># Replace with your workspace ID</span>

<span class="c1"># Get the API client</span>
<span class="n">api_client</span><span class="p">,</span> <span class="n">connection_type</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected using: </span><span class="si">{</span><span class="n">connection_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Example 1: List files in a workspace with a specific prefix</span>
    <span class="n">file_prefix</span> <span class="o">=</span> <span class="s2">&quot;data/&quot;</span>  <span class="c1"># List files in the &quot;data&quot; directory</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">list_workspace_files</span><span class="p">(</span><span class="n">api_client</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">file_prefix</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files in workspace with prefix &#39;</span><span class="si">{</span><span class="n">file_prefix</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example 2: Download a file from the workspace</span>
    <span class="n">file_to_download</span> <span class="o">=</span> <span class="s2">&quot;data/sample.csv&quot;</span>  <span class="c1"># Replace with an actual file in your workspace</span>
    <span class="n">target_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./downloaded_files&quot;</span><span class="p">)</span>
    <span class="n">target_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">downloaded_file</span> <span class="o">=</span> <span class="n">download_workspace_file</span><span class="p">(</span>
            <span class="n">api_client</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">file_to_download</span><span class="p">,</span> <span class="n">target_directory</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded file to: </span><span class="si">{</span><span class="n">downloaded_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error downloading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example 3: Upload a file to the workspace</span>
    <span class="n">file_to_upload</span> <span class="o">=</span> <span class="s2">&quot;./local_data/upload_sample.csv&quot;</span>  <span class="c1"># Replace with a local file path</span>
    <span class="n">workspace_destination</span> <span class="o">=</span> <span class="s2">&quot;data/uploaded/&quot;</span>  <span class="c1"># Destination in the workspace (ending with / to keep filename)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">upload_workspace_file</span><span class="p">(</span>
            <span class="n">api_client</span><span class="p">,</span>
            <span class="n">organization_id</span><span class="p">,</span>
            <span class="n">workspace_id</span><span class="p">,</span>
            <span class="n">file_to_upload</span><span class="p">,</span>
            <span class="n">workspace_destination</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set to False to prevent overwriting existing files</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded file as: </span><span class="si">{</span><span class="n">uploaded_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error uploading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Always close the API client when done</span>
    <span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="listing-files">Listing Files<a class="headerlink" href="#listing-files" title="Permanent link">&para;</a></h3>
<p>The <code>list_workspace_files</code> function allows you to list files in a workspace with a specific prefix:</p>
<div class="highlight"><pre><span></span><code><span class="n">files</span> <span class="o">=</span> <span class="n">list_workspace_files</span><span class="p">(</span><span class="n">api_client</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">file_prefix</span><span class="p">)</span>
</code></pre></div>
<p>This is useful for finding files in a specific directory or with a specific naming pattern.</p>
<h3 id="downloading-files">Downloading Files<a class="headerlink" href="#downloading-files" title="Permanent link">&para;</a></h3>
<p>The <code>download_workspace_file</code> function downloads a file from the workspace to a local directory:</p>
<div class="highlight"><pre><span></span><code><span class="n">downloaded_file</span> <span class="o">=</span> <span class="n">download_workspace_file</span><span class="p">(</span>
    <span class="n">api_client</span><span class="p">,</span> 
    <span class="n">organization_id</span><span class="p">,</span> 
    <span class="n">workspace_id</span><span class="p">,</span> 
    <span class="n">file_to_download</span><span class="p">,</span> 
    <span class="n">target_directory</span>
<span class="p">)</span>
</code></pre></div>
<p>If the file is in a subdirectory in the workspace, the function will create the necessary local subdirectories.</p>
<h3 id="uploading-files">Uploading Files<a class="headerlink" href="#uploading-files" title="Permanent link">&para;</a></h3>
<p>The <code>upload_workspace_file</code> function uploads a local file to the workspace:</p>
<div class="highlight"><pre><span></span><code><span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">upload_workspace_file</span><span class="p">(</span>
    <span class="n">api_client</span><span class="p">,</span>
    <span class="n">organization_id</span><span class="p">,</span>
    <span class="n">workspace_id</span><span class="p">,</span>
    <span class="n">file_to_upload</span><span class="p">,</span>
    <span class="n">workspace_destination</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>workspace_destination</code> parameter can be:
- A specific file path in the workspace
- A directory path ending with <code>/</code>, in which case the original filename is preserved</p>
<div class="admonition tip">
<p class="admonition-title">Workspace Paths</p>
<p>When working with workspace paths:</p>
<ul>
<li>Use forward slashes (<code>/</code>) regardless of your operating system</li>
<li>End directory paths with a trailing slash (<code>/</code>)</li>
<li>Use relative paths from the workspace root</li>
</ul>
</div>
<h2 id="twin-data-layer-operations">Twin Data Layer Operations<a class="headerlink" href="#twin-data-layer-operations" title="Permanent link">&para;</a></h2>
<p>The Twin Data Layer (TDL) is a graph database that stores nodes and relationships. CoAL provides tools for working with the TDL, particularly for preparing and sending CSV data.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Twin Data Layer operations</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Example: Working with the Twin Data Layer in the CosmoTech API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_api_client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.twin_data_layer</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSVSourceFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech_api.api.twin_graph_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwinGraphApi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LOGGER</span>

<span class="c1"># Set up environment variables for authentication</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.cosmotech.com&quot;</span>  <span class="c1"># Replace with your API URL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>  <span class="c1"># Replace with your actual API key</span>

<span class="c1"># Organization and workspace IDs</span>
<span class="n">organization_id</span> <span class="o">=</span> <span class="s2">&quot;your-organization-id&quot;</span>  <span class="c1"># Replace with your organization ID</span>
<span class="n">workspace_id</span> <span class="o">=</span> <span class="s2">&quot;your-workspace-id&quot;</span>  <span class="c1"># Replace with your workspace ID</span>
<span class="n">twin_graph_id</span> <span class="o">=</span> <span class="s2">&quot;your-twin-graph-id&quot;</span>  <span class="c1"># Replace with your twin graph ID</span>

<span class="c1"># Get the API client</span>
<span class="n">api_client</span><span class="p">,</span> <span class="n">connection_type</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected using: </span><span class="si">{</span><span class="n">connection_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Create a TwinGraphApi instance</span>
    <span class="n">twin_graph_api</span> <span class="o">=</span> <span class="n">TwinGraphApi</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Example 1: Create sample CSV files for nodes and relationships</span>

    <span class="c1"># Create a directory for our sample data</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./tdl_sample_data&quot;</span><span class="p">)</span>
    <span class="n">data_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create a sample nodes CSV file (Person nodes)</span>
    <span class="n">persons_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s2">&quot;Person.csv&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">persons_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span> <span class="s2">&quot;New York&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p2&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p3&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span> <span class="s2">&quot;35&quot;</span><span class="p">,</span> <span class="s2">&quot;Chicago&quot;</span><span class="p">])</span>

    <span class="c1"># Create a sample relationships CSV file (KNOWS relationships)</span>
    <span class="n">knows_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s2">&quot;KNOWS.csv&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">knows_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="s2">&quot;since&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;p2&quot;</span><span class="p">,</span> <span class="s2">&quot;2020&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p2&quot;</span><span class="p">,</span> <span class="s2">&quot;p3&quot;</span><span class="p">,</span> <span class="s2">&quot;2021&quot;</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;p3&quot;</span><span class="p">,</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="s2">&quot;2019&quot;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created sample CSV files in </span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example 2: Parse CSV files and generate Cypher queries</span>

    <span class="c1"># Parse the nodes CSV file</span>
    <span class="n">person_csv</span> <span class="o">=</span> <span class="n">CSVSourceFile</span><span class="p">(</span><span class="n">persons_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsed </span><span class="si">{</span><span class="n">person_csv</span><span class="o">.</span><span class="n">object_type</span><span class="si">}</span><span class="s2"> CSV file:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Is node: </span><span class="si">{</span><span class="n">person_csv</span><span class="o">.</span><span class="n">is_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fields: </span><span class="si">{</span><span class="n">person_csv</span><span class="o">.</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID column: </span><span class="si">{</span><span class="n">person_csv</span><span class="o">.</span><span class="n">id_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate a Cypher query for creating nodes</span>
    <span class="n">person_query</span> <span class="o">=</span> <span class="n">person_csv</span><span class="o">.</span><span class="n">generate_query_insert</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generated Cypher query for </span><span class="si">{</span><span class="n">person_csv</span><span class="o">.</span><span class="n">object_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">person_query</span><span class="p">)</span>

    <span class="c1"># Parse the relationships CSV file</span>
    <span class="n">knows_csv</span> <span class="o">=</span> <span class="n">CSVSourceFile</span><span class="p">(</span><span class="n">knows_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parsed </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">object_type</span><span class="si">}</span><span class="s2"> CSV file:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Is node: </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">is_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Fields: </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Source column: </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">source_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Target column: </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">target_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate a Cypher query for creating relationships</span>
    <span class="n">knows_query</span> <span class="o">=</span> <span class="n">knows_csv</span><span class="o">.</span><span class="n">generate_query_insert</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generated Cypher query for </span><span class="si">{</span><span class="n">knows_csv</span><span class="o">.</span><span class="n">object_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">knows_query</span><span class="p">)</span>

    <span class="c1"># Example 3: Send data to the Twin Data Layer (commented out as it requires an actual twin graph)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # For nodes, you would typically:</span>
<span class="sd">    with open(persons_file, &quot;r&quot;) as f:</span>
<span class="sd">        reader = csv.DictReader(f)</span>
<span class="sd">        for row in reader:</span>
<span class="sd">            # Create parameters for the Cypher query</span>
<span class="sd">            params = {k: v for k, v in row.items()}</span>

<span class="sd">            # Execute the query</span>
<span class="sd">            twin_graph_api.run_twin_graph_cypher_query(</span>
<span class="sd">                organization_id=organization_id,</span>
<span class="sd">                workspace_id=workspace_id,</span>
<span class="sd">                twin_graph_id=twin_graph_id,</span>
<span class="sd">                twin_graph_cypher_query={</span>
<span class="sd">                    &quot;query&quot;: person_query,</span>
<span class="sd">                    &quot;parameters&quot;: params</span>
<span class="sd">                }</span>
<span class="sd">            )</span>

<span class="sd">    # For relationships, you would typically:</span>
<span class="sd">    with open(knows_file, &quot;r&quot;) as f:</span>
<span class="sd">        reader = csv.DictReader(f)</span>
<span class="sd">        for row in reader:</span>
<span class="sd">            # Create parameters for the Cypher query</span>
<span class="sd">            params = {k: v for k, v in row.items()}</span>

<span class="sd">            # Execute the query</span>
<span class="sd">            twin_graph_api.run_twin_graph_cypher_query(</span>
<span class="sd">                organization_id=organization_id,</span>
<span class="sd">                workspace_id=workspace_id,</span>
<span class="sd">                twin_graph_id=twin_graph_id,</span>
<span class="sd">                twin_graph_cypher_query={</span>
<span class="sd">                    &quot;query&quot;: knows_query,</span>
<span class="sd">                    &quot;parameters&quot;: params</span>
<span class="sd">                }</span>
<span class="sd">            )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Example 4: Query data from the Twin Data Layer (commented out as it requires an actual twin graph)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # Execute a Cypher query to get all Person nodes</span>
<span class="sd">    result = twin_graph_api.run_twin_graph_cypher_query(</span>
<span class="sd">        organization_id=organization_id,</span>
<span class="sd">        workspace_id=workspace_id,</span>
<span class="sd">        twin_graph_id=twin_graph_id,</span>
<span class="sd">        twin_graph_cypher_query={</span>
<span class="sd">            &quot;query&quot;: &quot;MATCH (p:Person) RETURN p.id, p.name, p.age, p.city&quot;,</span>
<span class="sd">            &quot;parameters&quot;: {}</span>
<span class="sd">        }</span>
<span class="sd">    )</span>

<span class="sd">    # Process the results</span>
<span class="sd">    print(&quot;\nPerson nodes in the Twin Data Layer:&quot;)</span>
<span class="sd">    for record in result.records:</span>
<span class="sd">        print(f&quot;  - {record}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Always close the API client when done</span>
    <span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="csv-file-format">CSV File Format<a class="headerlink" href="#csv-file-format" title="Permanent link">&para;</a></h3>
<p>The TDL expects CSV files in a specific format:</p>
<ul>
<li><strong>Node files</strong>: Must have an <code>id</code> column and can have additional property columns</li>
<li><strong>Relationship files</strong>: Must have <code>src</code> and <code>dest</code> columns and can have additional property columns</li>
</ul>
<p>The filename (without the <code>.csv</code> extension) becomes the node label or relationship type in the graph.</p>
<h3 id="parsing-csv-files">Parsing CSV Files<a class="headerlink" href="#parsing-csv-files" title="Permanent link">&para;</a></h3>
<p>The <code>CSVSourceFile</code> class helps parse CSV files and determine if they represent nodes or relationships:</p>
<div class="highlight"><pre><span></span><code><span class="n">csv_file</span> <span class="o">=</span> <span class="n">CSVSourceFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Is node: </span><span class="si">{</span><span class="n">csv_file</span><span class="o">.</span><span class="n">is_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields: </span><span class="si">{</span><span class="n">csv_file</span><span class="o">.</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="generating-cypher-queries">Generating Cypher Queries<a class="headerlink" href="#generating-cypher-queries" title="Permanent link">&para;</a></h3>
<p>The <code>generate_query_insert</code> method creates Cypher queries for inserting data into the TDL:</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">generate_query_insert</span><span class="p">()</span>
</code></pre></div>
<p>These queries can then be executed using the TwinGraphApi:</p>
<div class="highlight"><pre><span></span><code><span class="n">twin_graph_api</span><span class="o">.</span><span class="n">run_twin_graph_cypher_query</span><span class="p">(</span>
    <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
    <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_id</span><span class="p">,</span>
    <span class="n">twin_graph_id</span><span class="o">=</span><span class="n">twin_graph_id</span><span class="p">,</span>
    <span class="n">twin_graph_cypher_query</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">params</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Node References</p>
<p>When creating relationships, make sure the nodes referenced by the <code>src</code> and <code>dest</code> columns already exist in the graph. Otherwise, the relationship creation will fail.</p>
</div>
<h2 id="runner-and-run-management">Runner and Run Management<a class="headerlink" href="#runner-and-run-management" title="Permanent link">&para;</a></h2>
<p>Runners and runs are central concepts in the CosmoTech platform. CoAL provides functions for working with runner data, parameters, and associated datasets.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Runner operations</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Example: Working with runners and runs in the CosmoTech API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_api_client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.runner</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_runner_data</span><span class="p">,</span>
    <span class="n">get_runner_parameters</span><span class="p">,</span>
    <span class="n">download_runner_data</span><span class="p">,</span>
    <span class="n">download_datasets</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LOGGER</span>

<span class="c1"># Set up environment variables for authentication</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.cosmotech.com&quot;</span>  <span class="c1"># Replace with your API URL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>  <span class="c1"># Replace with your actual API key</span>

<span class="c1"># Organization, workspace, and runner IDs</span>
<span class="n">organization_id</span> <span class="o">=</span> <span class="s2">&quot;your-organization-id&quot;</span>  <span class="c1"># Replace with your organization ID</span>
<span class="n">workspace_id</span> <span class="o">=</span> <span class="s2">&quot;your-workspace-id&quot;</span>  <span class="c1"># Replace with your workspace ID</span>
<span class="n">runner_id</span> <span class="o">=</span> <span class="s2">&quot;your-runner-id&quot;</span>  <span class="c1"># Replace with your runner ID</span>

<span class="c1"># Get the API client</span>
<span class="n">api_client</span><span class="p">,</span> <span class="n">connection_type</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected using: </span><span class="si">{</span><span class="n">connection_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Example 1: Get runner data</span>
    <span class="n">runner_data</span> <span class="o">=</span> <span class="n">get_runner_data</span><span class="p">(</span><span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runner name: </span><span class="si">{</span><span class="n">runner_data</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runner ID: </span><span class="si">{</span><span class="n">runner_data</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runner state: </span><span class="si">{</span><span class="n">runner_data</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example 2: Get runner parameters</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_runner_parameters</span><span class="p">(</span><span class="n">runner_data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Runner parameters:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameterId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (type: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;varType&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Example 3: Download runner data (parameters and datasets)</span>
    <span class="c1"># Create directories for parameters and datasets</span>
    <span class="n">param_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./runner_parameters&quot;</span><span class="p">)</span>
    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./runner_datasets&quot;</span><span class="p">)</span>
    <span class="n">param_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataset_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Download runner data</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">download_runner_data</span><span class="p">(</span>
        <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
        <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_id</span><span class="p">,</span>
        <span class="n">runner_id</span><span class="o">=</span><span class="n">runner_id</span><span class="p">,</span>
        <span class="n">parameter_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">param_dir</span><span class="p">),</span>
        <span class="n">dataset_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dataset_dir</span><span class="p">),</span>
        <span class="n">read_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Read file contents</span>
        <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Download datasets in parallel</span>
        <span class="n">write_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Write parameters as JSON</span>
        <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Write parameters as CSV</span>
        <span class="n">fetch_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Fetch datasets</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Downloaded runner data:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Parameters saved to: </span><span class="si">{</span><span class="n">param_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Datasets saved to: </span><span class="si">{</span><span class="n">dataset_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Example 4: Working with specific datasets</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;datasets&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Datasets associated with the runner:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">dataset_info</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;datasets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Dataset ID: </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Name: </span><span class="si">{</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># List files in the dataset</span>
            <span class="k">if</span> <span class="s2">&quot;files&quot;</span> <span class="ow">in</span> <span class="n">dataset_info</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Files:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      - </span><span class="si">{</span><span class="n">file_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No datasets associated with this runner.&quot;</span><span class="p">)</span>

    <span class="c1"># Example 5: Download specific datasets</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    from cosmotech.coal.cosmotech_api.runner import get_dataset_ids_from_runner</span>

<span class="sd">    # Get dataset IDs from the runner</span>
<span class="sd">    dataset_ids = get_dataset_ids_from_runner(runner_data)</span>

<span class="sd">    if dataset_ids:</span>
<span class="sd">        # Create a directory for the datasets</span>
<span class="sd">        specific_dataset_dir = pathlib.Path(&quot;./specific_datasets&quot;)</span>
<span class="sd">        specific_dataset_dir.mkdir(exist_ok=True, parents=True)</span>

<span class="sd">        # Download the datasets</span>
<span class="sd">        datasets = download_datasets(</span>
<span class="sd">            organization_id=organization_id,</span>
<span class="sd">            workspace_id=workspace_id,</span>
<span class="sd">            dataset_ids=dataset_ids,</span>
<span class="sd">            read_files=True,</span>
<span class="sd">            parallel=True,</span>
<span class="sd">        )</span>

<span class="sd">        print(&quot;\nDownloaded specific datasets:&quot;)</span>
<span class="sd">        for dataset_id, dataset_info in datasets.items():</span>
<span class="sd">            print(f&quot;  - Dataset ID: {dataset_id}&quot;)</span>
<span class="sd">            print(f&quot;    Name: {dataset_info.get(&#39;name&#39;, &#39;N/A&#39;)}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Always close the API client when done</span>
    <span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="getting-runner-data">Getting Runner Data<a class="headerlink" href="#getting-runner-data" title="Permanent link">&para;</a></h3>
<p>The <code>get_runner_data</code> function retrieves information about a runner:</p>
<div class="highlight"><pre><span></span><code><span class="n">runner_data</span> <span class="o">=</span> <span class="n">get_runner_data</span><span class="p">(</span><span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">)</span>
</code></pre></div>
<h3 id="working-with-parameters">Working with Parameters<a class="headerlink" href="#working-with-parameters" title="Permanent link">&para;</a></h3>
<p>The <code>get_runner_parameters</code> function extracts parameters from runner data:</p>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="n">get_runner_parameters</span><span class="p">(</span><span class="n">runner_data</span><span class="p">)</span>
</code></pre></div>
<h3 id="downloading-runner-data">Downloading Runner Data<a class="headerlink" href="#downloading-runner-data" title="Permanent link">&para;</a></h3>
<p>The <code>download_runner_data</code> function downloads all data associated with a runner, including parameters and datasets:</p>
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">download_runner_data</span><span class="p">(</span>
    <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
    <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_id</span><span class="p">,</span>
    <span class="n">runner_id</span><span class="o">=</span><span class="n">runner_id</span><span class="p">,</span>
    <span class="n">parameter_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">param_dir</span><span class="p">),</span>
    <span class="n">dataset_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dataset_dir</span><span class="p">),</span>
    <span class="n">write_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fetch_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>This function:
- Downloads parameters and writes them as JSON and/or CSV files
- Downloads associated datasets
- Organizes everything in the specified directories</p>
<div class="admonition tip">
<p class="admonition-title">Dataset References</p>
<p>Runners can reference datasets in two ways:</p>
<ul>
<li>Through parameters with the <code>%DATASETID%</code> variable type</li>
<li>Through the <code>dataset_list</code> property</li>
</ul>
<p>The <code>download_runner_data</code> function handles both types of references.</p>
</div>
<h2 id="complete-workflow-example">Complete Workflow Example<a class="headerlink" href="#complete-workflow-example" title="Permanent link">&para;</a></h2>
<p>Putting it all together, here's a complete workflow that demonstrates how to use the CosmoTech API for a data processing pipeline:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Complete workflow</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Example: Complete workflow using the CosmoTech API</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_api_client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.runner</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_runner_data</span><span class="p">,</span>
    <span class="n">download_runner_data</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.workspace</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">list_workspace_files</span><span class="p">,</span>
    <span class="n">download_workspace_file</span><span class="p">,</span>
    <span class="n">upload_workspace_file</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.cosmotech_api.twin_data_layer</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSVSourceFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech_api.api.twin_graph_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwinGraphApi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech_api.api.dataset_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetApi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosmotech.coal.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LOGGER</span>

<span class="c1"># Set up environment variables for authentication</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.cosmotech.com&quot;</span>  <span class="c1"># Replace with your API URL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CSM_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>  <span class="c1"># Replace with your actual API key</span>

<span class="c1"># Organization, workspace, and runner IDs</span>
<span class="n">organization_id</span> <span class="o">=</span> <span class="s2">&quot;your-organization-id&quot;</span>  <span class="c1"># Replace with your organization ID</span>
<span class="n">workspace_id</span> <span class="o">=</span> <span class="s2">&quot;your-workspace-id&quot;</span>  <span class="c1"># Replace with your workspace ID</span>
<span class="n">runner_id</span> <span class="o">=</span> <span class="s2">&quot;your-runner-id&quot;</span>  <span class="c1"># Replace with your runner ID</span>
<span class="n">twin_graph_id</span> <span class="o">=</span> <span class="s2">&quot;your-twin-graph-id&quot;</span>  <span class="c1"># Replace with your twin graph ID</span>

<span class="c1"># Create directories for our workflow</span>
<span class="n">workflow_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./workflow_example&quot;</span><span class="p">)</span>
<span class="n">workflow_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">input_dir</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s2">&quot;input&quot;</span>
<span class="n">processed_dir</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s2">&quot;processed&quot;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s2">&quot;output&quot;</span>

<span class="n">input_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">processed_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Get the API client</span>
<span class="n">api_client</span><span class="p">,</span> <span class="n">connection_type</span> <span class="o">=</span> <span class="n">get_api_client</span><span class="p">()</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected using: </span><span class="si">{</span><span class="n">connection_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Step 1: Download runner data (parameters and datasets)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 1: Download Runner Data ===&quot;</span><span class="p">)</span>

    <span class="n">runner_data</span> <span class="o">=</span> <span class="n">get_runner_data</span><span class="p">(</span><span class="n">organization_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">runner_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runner name: </span><span class="si">{</span><span class="n">runner_data</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">download_runner_data</span><span class="p">(</span>
        <span class="n">organization_id</span><span class="o">=</span><span class="n">organization_id</span><span class="p">,</span>
        <span class="n">workspace_id</span><span class="o">=</span><span class="n">workspace_id</span><span class="p">,</span>
        <span class="n">runner_id</span><span class="o">=</span><span class="n">runner_id</span><span class="p">,</span>
        <span class="n">parameter_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">/</span> <span class="s2">&quot;parameters&quot;</span><span class="p">),</span>
        <span class="n">dataset_folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span><span class="p">),</span>
        <span class="n">write_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">write_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded runner data to </span><span class="si">{</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Process the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 2: Process Data ===&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we&#39;ll create a simple transformation:</span>
    <span class="c1"># - Read a CSV file from the input</span>
    <span class="c1"># - Transform it</span>
    <span class="c1"># - Write the result to the processed directory</span>

    <span class="c1"># Let&#39;s assume we have a &quot;customers.csv&quot; file in the input directory</span>
    <span class="n">customers_file</span> <span class="o">=</span> <span class="n">input_dir</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span> <span class="o">/</span> <span class="s2">&quot;customers.csv&quot;</span>

    <span class="c1"># If the file doesn&#39;t exist for this example, create a sample one</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customers_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating sample customers.csv file for demonstration&quot;</span><span class="p">)</span>
        <span class="n">customers_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">customers_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;spending&quot;</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span> <span class="s2">&quot;New York&quot;</span><span class="p">,</span> <span class="s2">&quot;1500&quot;</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">])</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;c3&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">,</span> <span class="s2">&quot;35&quot;</span><span class="p">,</span> <span class="s2">&quot;Chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;1200&quot;</span><span class="p">])</span>

    <span class="c1"># Read the customers data</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">customers_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">customers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span><span class="si">}</span><span class="s2"> customers from </span><span class="si">{</span><span class="n">customers_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Process the data: calculate a loyalty score based on age and spending</span>
    <span class="k">for</span> <span class="n">customer</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">:</span>
        <span class="n">age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">customer</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
        <span class="n">spending</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">customer</span><span class="p">[</span><span class="s2">&quot;spending&quot;</span><span class="p">])</span>

        <span class="c1"># Simple formula: loyalty score = spending / 100 + (age - 20) / 10</span>
        <span class="n">loyalty_score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">spending</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">customer</span><span class="p">[</span><span class="s2">&quot;loyalty_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">loyalty_score</span><span class="p">)</span>

    <span class="c1"># Write the processed data</span>
    <span class="n">processed_file</span> <span class="o">=</span> <span class="n">processed_dir</span> <span class="o">/</span> <span class="s2">&quot;customers_with_loyalty.csv&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">processed_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;spending&quot;</span><span class="p">,</span> <span class="s2">&quot;loyalty_score&quot;</span><span class="p">]</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed data written to </span><span class="si">{</span><span class="n">processed_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Upload the processed file to the workspace</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 3: Upload Processed Data to Workspace ===&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">upload_workspace_file</span><span class="p">(</span>
            <span class="n">api_client</span><span class="p">,</span>
            <span class="n">organization_id</span><span class="p">,</span>
            <span class="n">workspace_id</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">processed_file</span><span class="p">),</span>
            <span class="s2">&quot;processed_data/&quot;</span><span class="p">,</span>  <span class="c1"># Destination in the workspace</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded processed file as: </span><span class="si">{</span><span class="n">uploaded_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error uploading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: Create a dataset from the processed data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 4: Create Dataset from Processed Data ===&quot;</span><span class="p">)</span>

    <span class="c1"># This step would typically involve:</span>
    <span class="c1"># 1. Creating a dataset in the CosmoTech API</span>
    <span class="c1"># 2. Uploading files to the dataset</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # Create a dataset</span>
<span class="sd">    dataset_api = DatasetApi(api_client)</span>

<span class="sd">    new_dataset = {</span>
<span class="sd">        &quot;name&quot;: &quot;Customers with Loyalty Scores&quot;,</span>
<span class="sd">        &quot;description&quot;: &quot;Processed customer data with calculated loyalty scores&quot;,</span>
<span class="sd">        &quot;tags&quot;: [&quot;processed&quot;, &quot;customers&quot;, &quot;loyalty&quot;]</span>
<span class="sd">    }</span>

<span class="sd">    try:</span>
<span class="sd">        dataset = dataset_api.create_dataset(</span>
<span class="sd">            organization_id=organization_id,</span>
<span class="sd">            workspace_id=workspace_id,</span>
<span class="sd">            dataset=new_dataset</span>
<span class="sd">        )</span>

<span class="sd">        dataset_id = dataset.id</span>
<span class="sd">        print(f&quot;Created dataset with ID: {dataset_id}&quot;)</span>

<span class="sd">        # Upload the processed file to the dataset</span>
<span class="sd">        # This would typically involve additional API calls</span>
<span class="sd">        # ...</span>

<span class="sd">    except Exception as e:</span>
<span class="sd">        print(f&quot;Error creating dataset: {e}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Step 5: Send data to the Twin Data Layer</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 5: Send Data to Twin Data Layer ===&quot;</span><span class="p">)</span>

    <span class="c1"># Parse the processed CSV file for the Twin Data Layer</span>
    <span class="n">customer_csv</span> <span class="o">=</span> <span class="n">CSVSourceFile</span><span class="p">(</span><span class="n">processed_file</span><span class="p">)</span>

    <span class="c1"># Generate a Cypher query for creating nodes</span>
    <span class="n">customer_query</span> <span class="o">=</span> <span class="n">customer_csv</span><span class="o">.</span><span class="n">generate_query_insert</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated Cypher query for Customer nodes:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">customer_query</span><span class="p">)</span>

    <span class="c1"># In a real scenario, you would send this data to the Twin Data Layer</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    twin_graph_api = TwinGraphApi(api_client)</span>

<span class="sd">    # For each customer, create a node in the Twin Data Layer</span>
<span class="sd">    with open(processed_file, &quot;r&quot;) as f:</span>
<span class="sd">        reader = csv.DictReader(f)</span>
<span class="sd">        for row in reader:</span>
<span class="sd">            # Create parameters for the Cypher query</span>
<span class="sd">            params = {k: v for k, v in row.items()}</span>

<span class="sd">            # Execute the query</span>
<span class="sd">            twin_graph_api.run_twin_graph_cypher_query(</span>
<span class="sd">                organization_id=organization_id,</span>
<span class="sd">                workspace_id=workspace_id,</span>
<span class="sd">                twin_graph_id=twin_graph_id,</span>
<span class="sd">                twin_graph_cypher_query={</span>
<span class="sd">                    &quot;query&quot;: customer_query,</span>
<span class="sd">                    &quot;parameters&quot;: params</span>
<span class="sd">                }</span>
<span class="sd">            )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Step 6: Generate a report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Step 6: Generate Report ===&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate some statistics</span>
    <span class="n">total_customers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>
    <span class="n">avg_age</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_customers</span>
    <span class="n">avg_spending</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;spending&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_customers</span>
    <span class="n">avg_loyalty</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;loyalty_score&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_customers</span>

    <span class="c1"># Create a report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;report_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-02-28&quot;</span><span class="p">,</span>
        <span class="s2">&quot;runner_id&quot;</span><span class="p">:</span> <span class="n">runner_id</span><span class="p">,</span>
        <span class="s2">&quot;statistics&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;total_customers&quot;</span><span class="p">:</span> <span class="n">total_customers</span><span class="p">,</span>
            <span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_age</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;average_spending&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_spending</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;average_loyalty_score&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_loyalty</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;top_customers&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">customers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;loyalty_score&quot;</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
            <span class="p">:</span><span class="mi">2</span>
        <span class="p">],</span>  <span class="c1"># Top 2 customers by loyalty score</span>
    <span class="p">}</span>

    <span class="c1"># Write the report to a JSON file</span>
    <span class="n">report_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;customer_report.json&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report generated and saved to </span><span class="si">{</span><span class="n">report_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Print a summary of the report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Report Summary:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Customers: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;total_customers&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Age: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;average_age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Spending: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;average_spending&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Loyalty Score: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;statistics&#39;</span><span class="p">][</span><span class="s1">&#39;average_loyalty_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top Customers by Loyalty Score:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">customer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;top_customers&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">customer</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Score: </span><span class="si">{</span><span class="n">customer</span><span class="p">[</span><span class="s1">&#39;loyalty_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Workflow completed successfully!&quot;</span><span class="p">)</span>

<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Always close the API client when done</span>
    <span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>This workflow:</p>
<ol>
<li>Downloads runner data (parameters and datasets)</li>
<li>Processes the data (calculates loyalty scores for customers)</li>
<li>Uploads the processed data to the workspace</li>
<li>Prepares the data for the Twin Data Layer</li>
<li>Generates a report with statistics and insights</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Real-world Workflows</p>
<p>In real-world scenarios, you might:</p>
<ul>
<li>Use more complex data transformations</li>
<li>Integrate with external systems</li>
<li>Implement error handling and retries</li>
<li>Add logging and monitoring</li>
<li>Parallelize operations for better performance</li>
</ul>
</div>
<h2 id="best-practices-and-tips">Best Practices and Tips<a class="headerlink" href="#best-practices-and-tips" title="Permanent link">&para;</a></h2>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<ul>
<li>Use environment variables for credentials</li>
<li>Implement proper secret management in production</li>
<li>Always close API clients when done</li>
</ul>
<h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="c1"># API operations</span>
<span class="k">except</span> <span class="n">cosmotech_api</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Handle API errors</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API error: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Handle other errors</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Always close the client</span>
    <span class="n">api_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<h3 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h3>
<ul>
<li>Download datasets in parallel when possible (<code>parallel=True</code>)</li>
<li>Batch operations when sending multiple items to the API</li>
<li>Use appropriate error handling and retries for network operations</li>
</ul>
<h3 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h3>
<ul>
<li>Never hardcode credentials in your code</li>
<li>Use the principle of least privilege for API keys and service principals</li>
<li>Validate and sanitize inputs before sending them to the API</li>
</ul>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>The CosmoTech API integration in CoAL provides a powerful way to interact with the CosmoTech platform programmatically. By leveraging these capabilities, you can:</p>
<ul>
<li>Automate workflows</li>
<li>Integrate with other systems</li>
<li>Build custom applications</li>
<li>Process and analyze data</li>
<li>Create end-to-end solutions</li>
</ul>
<p>Whether you're building data pipelines, creating custom interfaces, or integrating with existing systems, the CoAL library's API integration offers the tools you need to work effectively with the CosmoTech platform.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../contributing/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Contributing to CoAL">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Contributing to CoAL
              </div>
            </div>
          </a>
        
        
          
          <a href="../csm-data/" class="md-footer__link md-footer__link--next" aria-label="Next: CSM-DATA">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                CSM-DATA
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
    
    Made by
    <a href="https://cosmotech.com/" target="_blank" rel="noopener">
        Cosmotech
    </a>
    <br/>
    <br/>
    <a href="#__consent">Change cookie settings</a>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.annotate", "content.tooltips", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.indexes", "navigation.instant", "navigation.footer"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascript/tablesort.js"></script>
      
    
  </body>
</html>